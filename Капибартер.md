# Капибартер Write-up

made by seculeti 

## Задание

На площадке для обмена авто и запчастями Капибартер появились новенькие спортивные машины, которые отдают почти даром. Есть подозрение, что это краденые машины из Либерти-Каписити — и от них хотят поскорее избавиться.

Найдите доказательства, чтобы поймать воров и защитить капибар от обмана.

Приложение Капибартера для айфонов: [capybarter_b5d9890.ipa](https://t-ctf.ru/files/capybarter_b5d9890.ipa)

## Решение

Предварительно можно установить выданный файл, но возникнет две проблемы (одна гарантированно):
1. У игроков нет айфона
2. Для установки ипашки нужен сертификат для подписи.

У нас был и айфон, и сертификат. Установив и потыкав, можно случайно пять раз кликнуть в правый нижний угол и вызвать панель авторизации. Это может быть полезно, а может и не быть. В общем, без этого вполне решается.

![image](https://github.com/user-attachments/assets/4c25e447-44c3-4ff1-92b3-10d472929d7a)

Открываем терминал и распаковываем .ipa файл, так как он, по сути, является архивом: `unzip capybarter_b5d9890.ipa`. Переходим в директорию, здесь нас интересует единственный файл без расширения — capybarter-3.

![image](https://github.com/user-attachments/assets/3b1b5b98-64ce-485e-ae80-6c5a74d779ac)

Открываем файл в IDA, начинаем реверсить это нечто. Кликаем Shift+F12 и скипаем все файлы `HEAD`. В строках почти сразу заметим ссылку с уже знакомым нам доменом Т-СТФ. Там же лежит логин и пароль. Пробуем перейти по ссылке: https://t-barter-3zrm60ot.spbctf.org/api/v2/auth

Нас не пускает. Смотрим код ниже.

![image](https://github.com/user-attachments/assets/2eba6c11-2a30-4922-a7e8-c3cc173f2d55)

Полистав чуть ниже, видим, что авторизация успешно сработала на версии 1. Меняем ссылку, заменив версию: https://t-barter-3zrm60ot.spbctf.org/api/v1/auth

![image](https://github.com/user-attachments/assets/63bd35a6-da9c-44eb-b95f-f2f8d26ab18c)

Вводим данные:
- Логин: support
- Пароль: th1sisv3rys3cretP@55w0rD

![image](https://github.com/user-attachments/assets/cb3fa4b4-cd6a-49df-80cf-df900cb9bf66)

Тыкаем на машины, получаем флаг.
